<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Retrieve pre-built datasets from specific datamarts. — get_phrdw_data • phrdwRdata</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve pre-built datasets from specific datamarts. — get_phrdw_data"><meta name="description" content="Helps users retrieve pre-built datasets from specific datamarts, with the
capacity to supply values to some default filters, such as dates and
diseases.
In addition to retrieving data, user can perform preliminary
self-diagnostics to troubleshoot issues, return query instead of data, and
even supply filters outside the predefined default filters.
This function retains the legacy form, which can be invoked by providing
arguments with phrdw_ prefix, such as phrdw_datamart_connection and
phrdw_datamart.
The modern form, on the other hand, is invoked by a simple mart and/or
type, which streamlines the process, allows additional features, and
avoids redundant inputs such as phrdw_datamart in both
connect_to_phrdw() and get_phrdw_data()."><meta property="og:description" content="Helps users retrieve pre-built datasets from specific datamarts, with the
capacity to supply values to some default filters, such as dates and
diseases.
In addition to retrieving data, user can perform preliminary
self-diagnostics to troubleshoot issues, return query instead of data, and
even supply filters outside the predefined default filters.
This function retains the legacy form, which can be invoked by providing
arguments with phrdw_ prefix, such as phrdw_datamart_connection and
phrdw_datamart.
The modern form, on the other hand, is invoked by a simple mart and/or
type, which streamlines the process, allows additional features, and
avoids redundant inputs such as phrdw_datamart in both
connect_to_phrdw() and get_phrdw_data()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phrdwRdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/FAQ.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/Legacy.html">Legacy Usage of `get_phrdw_data()`</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikuo0628/phrdwRdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Retrieve pre-built datasets from specific datamarts.</h1>
      <small class="dont-index">Source: <a href="https://github.com/mikuo0628/phrdwRdata/blob/main/R/get_phrdw_data.R" class="external-link"><code>R/get_phrdw_data.R</code></a></small>
      <div class="d-none name"><code>get_phrdw_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Helps users retrieve pre-built datasets from specific datamarts, with the
capacity to supply values to some default filters, such as dates and
diseases.
In addition to retrieving data, user can perform preliminary
self-diagnostics to troubleshoot issues, return query instead of data, and
even supply filters outside the predefined default filters.</p>
<p>This function retains the legacy form, which can be invoked by providing
arguments with <code>phrdw_</code> prefix, such as <code>phrdw_datamart_connection</code> and
<code>phrdw_datamart</code>.</p>
<p>The modern form, on the other hand, is invoked by a simple <code>mart</code> and/or
<code>type</code>, which streamlines the process, allows additional features, and
avoids redundant inputs such as <code>phrdw_datamart</code> in both
<code><a href="connect_to_phrdw.html">connect_to_phrdw()</a></code> and <code>get_phrdw_data()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  phrdw_datamart_connection <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  phrdw_datamart <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_start_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query_end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include_patient_identifiers <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  include_indigenous_identifiers <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  retrieve_system_ids <span class="op">=</span> <span class="st">"Yes"</span>,</span>
<span>  disease <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  surveillance_condition <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  classification <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  surveillance_region_ha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  infection_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ordering_provider_ha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lis_status <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  episode_status <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  test_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  episode_testing_pattern <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  testing_region_ha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  case_status <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  case_source <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ucd_3_char_code <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ccd_3_char_code <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  residential_location_ha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  death_location_ha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mart <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prod"</span>, <span class="st">"su"</span>, <span class="st">"sa"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  .head <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .check_params <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  .return_query <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  .return_data <span class="op">=</span> <span class="op">!</span><span class="op">(</span><span class="va">.return_query</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">.check_params</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">.check_params</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  .clean_data <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  .query_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .query_str <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .cte <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-phrdw-datamart-connection">phrdw_datamart_connection<a class="anchor" aria-label="anchor" href="#arg-phrdw-datamart-connection"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded" class="external-link"><img src="figures/lifecycle-superseded.svg" alt="[Superseded]"></a></p>
<p>Legacy function design: supply a connection object created by
<code><a href="connect_to_phrdw.html">connect_to_phrdw()</a></code>. Recommend using <code>mart</code> and <code>type</code>
instead for flexibility (see <code><a href="connect_to_phrdw.html">connect_to_phrdw()</a></code>).
The function takes care of connecting
to the appropriate PHRDW database and disconnect after performing the
requested data filtering and retrieving.</p></dd>


<dt id="arg-phrdw-datamart">phrdw_datamart<a class="anchor" aria-label="anchor" href="#arg-phrdw-datamart"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded" class="external-link"><img src="figures/lifecycle-superseded.svg" alt="[Superseded]"></a></p>
<p>Legacy mart designations provided by previous package authors.
This backward-compatibility is meant to minimize changes on the user end.
The <code>stable</code> approach is to reference <code>mart</code> and <code>type</code>.</p></dd>


<dt id="arg-dataset-name">dataset_name<a class="anchor" aria-label="anchor" href="#arg-dataset-name"></a></dt>
<dd><p>The name of the pre-built dataset to retrieve.</p></dd>


<dt id="arg-query-start-date">query_start_date<a class="anchor" aria-label="anchor" href="#arg-query-start-date"></a></dt>
<dd><p>Start date of your dataset. Can accept character date.
Defaults to <code>NULL</code>, which indicates no lower bound.</p></dd>


<dt id="arg-query-end-date">query_end_date<a class="anchor" aria-label="anchor" href="#arg-query-end-date"></a></dt>
<dd><p>End date of your dataset. Can accept character date.
Defaults to <code>NULL</code>, which indicates no upper bound.</p></dd>


<dt id="arg-include-patient-identifiers">include_patient_identifiers<a class="anchor" aria-label="anchor" href="#arg-include-patient-identifiers"></a></dt>
<dd><p>Whether to include patient identifier
information. Accepts Boolean values. Defaults to <code>FALSE</code>. Note: user needs
to have access, otherwise data restriction may return unintended results.</p></dd>


<dt id="arg-include-indigenous-identifiers">include_indigenous_identifiers<a class="anchor" aria-label="anchor" href="#arg-include-indigenous-identifiers"></a></dt>
<dd><p>Whether to include indigenous
identifier information. Accepts Boolean values. Defaults to <code>FALSE</code>. Note:
user needs to have access, otherwise data restriction may return
unintended results.</p></dd>


<dt id="arg-retrieve-system-ids">retrieve_system_ids<a class="anchor" aria-label="anchor" href="#arg-retrieve-system-ids"></a></dt>
<dd><p>Whether to include systems IDs in the dataset.
Currently only applies to <code>Enteric</code> datamart. Defaults to legacy value "Yes",
but can accept Boolean, and no longer case-specific.</p></dd>


<dt id="arg-disease">disease<a class="anchor" aria-label="anchor" href="#arg-disease"></a></dt>
<dd><p>Optional. Character vector of diseases. Only applicable to
some datasets.</p></dd>


<dt id="arg-surveillance-condition">surveillance_condition<a class="anchor" aria-label="anchor" href="#arg-surveillance-condition"></a></dt>
<dd><p>Optional. Character vector of surveillance
conditions. Only for applicable datasets.</p></dd>


<dt id="arg-classification">classification<a class="anchor" aria-label="anchor" href="#arg-classification"></a></dt>
<dd><p>Optional. Character vector of classifications.
Only for applicable datasets.</p></dd>


<dt id="arg-surveillance-region-ha">surveillance_region_ha<a class="anchor" aria-label="anchor" href="#arg-surveillance-region-ha"></a></dt>
<dd><p>Optional. Character vector of Health Region
Authorities where the Patient lives/lived. Only for applicable datasets.</p></dd>


<dt id="arg-infection-group">infection_group<a class="anchor" aria-label="anchor" href="#arg-infection-group"></a></dt>
<dd><p>Optional. Character vector of infection groups.
Only for applicable datasets.</p></dd>


<dt id="arg-ordering-provider-ha">ordering_provider_ha<a class="anchor" aria-label="anchor" href="#arg-ordering-provider-ha"></a></dt>
<dd><p>Optional. Character vector of Health Region
Authorities where the Ordering Provide resides.
Only for applicable datasets.</p></dd>


<dt id="arg-lis-status">lis_status<a class="anchor" aria-label="anchor" href="#arg-lis-status"></a></dt>
<dd><p>Optional. Character vector of case level statuses about
the LIS data in a Case. Only for applicable datasets.</p></dd>


<dt id="arg-episode-status">episode_status<a class="anchor" aria-label="anchor" href="#arg-episode-status"></a></dt>
<dd><p>Optional. Character vector of episode statuses from the
LIS result processing and rule engine. Only for applicable datasets.</p></dd>


<dt id="arg-test-type">test_type<a class="anchor" aria-label="anchor" href="#arg-test-type"></a></dt>
<dd><p>Optional. Character vector of the types of tests. Only for
applicable datasets.</p></dd>


<dt id="arg-episode-testing-pattern">episode_testing_pattern<a class="anchor" aria-label="anchor" href="#arg-episode-testing-pattern"></a></dt>
<dd><p>Optional. Character vector of testing patterns.
Only for applicable datasets.</p></dd>


<dt id="arg-testing-region-ha">testing_region_ha<a class="anchor" aria-label="anchor" href="#arg-testing-region-ha"></a></dt>
<dd><p>Optional. Character vector of testing Health Region
Authorities. Only for applicable datasets.</p></dd>


<dt id="arg-case-status">case_status<a class="anchor" aria-label="anchor" href="#arg-case-status"></a></dt>
<dd><p>Optional. Character vector of case status. Only for
applicable datasets.</p></dd>


<dt id="arg-case-source">case_source<a class="anchor" aria-label="anchor" href="#arg-case-source"></a></dt>
<dd><p>Optional. Character vector of case status. Only for
applicable datasets.</p></dd>


<dt id="arg-ucd-char-code">ucd_3_char_code<a class="anchor" aria-label="anchor" href="#arg-ucd-char-code"></a></dt>
<dd><p>Optional. Character vector of UCD 3-character codes.
Only for applicable CDI datasets.</p></dd>


<dt id="arg-ccd-char-code">ccd_3_char_code<a class="anchor" aria-label="anchor" href="#arg-ccd-char-code"></a></dt>
<dd><p>Optional. Character vector of CCD 3-character codes.
Only for applicable CDI datasets.</p></dd>


<dt id="arg-residential-location-ha">residential_location_ha<a class="anchor" aria-label="anchor" href="#arg-residential-location-ha"></a></dt>
<dd><p>Optional. Character vector of BC Health
Authorities associated with decedant's usual residence.
Only for applicable CDI datasets.</p></dd>


<dt id="arg-death-location-ha">death_location_ha<a class="anchor" aria-label="anchor" href="#arg-death-location-ha"></a></dt>
<dd><p>Optional. Character vector of BC Health
Authorities associated with decedant's location of death.
Only for applicable CDI datasets.</p></dd>


<dt id="arg-mart">mart<a class="anchor" aria-label="anchor" href="#arg-mart"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>Provide an appropriate mart name (non-case specific).
Must be one of "CDI", "CD", "Respiratory", "Enteric", "STIBBI", and "VPD".
Non case-sensitive.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>Provide an appropriate mart type (non-case specific).
Must be one of "prod" (default), "su", or "sa".
Non case-sensitive. See <code>Details</code>.</p></dd>


<dt id="arg--head">.head<a class="anchor" aria-label="anchor" href="#arg--head"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>Optional. Single integer vector to indicate how many rows from the top
to return. Note: <code>tail</code> is not supported on database backends.</p></dd>


<dt id="arg--check-params">.check_params<a class="anchor" aria-label="anchor" href="#arg--check-params"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>Can accept Boolean or character values.</p>
<p>Boolean <code>TRUE</code> will return general info of the dataset:
For MDX queries: dimensions, hierarchies, and levels if possible, and
hierarchies for default filters.
For SQL queries: column names as they are in the source tables, and what
they are renamed to, and columns for default filters.</p>
<p>On the other hand, user can supply hierarchy or column names retrieved from
the above as character vector, and a list of the cardinal levels will
return. Useful to check for typos, or available names to filter for.</p></dd>


<dt id="arg--return-query">.return_query<a class="anchor" aria-label="anchor" href="#arg--return-query"></a></dt>
<dd><p>Boolean value. Whether to return query or not.</p></dd>


<dt id="arg--return-data">.return_data<a class="anchor" aria-label="anchor" href="#arg--return-data"></a></dt>
<dd><p>Boolean value. Whether to return data or not.</p></dd>


<dt id="arg--clean-data">.clean_data<a class="anchor" aria-label="anchor" href="#arg--clean-data"></a></dt>
<dd><p>Boolean value. Whether to attempt cleaning the dates in
data or not.</p></dd>


<dt id="arg--query-str">.query_str<a class="anchor" aria-label="anchor" href="#arg--query-str"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>TODO
Single character vector of query. User is responsible for syntax validity
and compatibility (ie. OLAP or SQL, appropriate access, etc) of the query.</p></dd>


<dt id="arg--cte">.cte<a class="anchor" aria-label="anchor" href="#arg--cte"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>Experimental support for common table expressions (CTEs). Defaults to
<code>FALSE</code>.
This is the equivalent of <code>pipe</code>, which in essence allows writing
subqueries in the order in which they are evaluated. Supported in
<code><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">dplyr::show_query()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::compute()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code>. This
is one of the ways to optimize SQL execution: using CTEs <code>WITH</code> instead of
subqueries.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>User can supply named vector: names being the column or
hierarchy name, and elements of the vector being the value to filter for.
See <code>Details</code>.</p></dd>


<dt id="arg--query-info">.query_info<a class="anchor" aria-label="anchor" href="#arg--query-info"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>TODO
A user supplied <code>data.frame</code> object similar to
'phrdwRdata:::list_query_info', on which the appropriate operation will
take place and retrieve specified data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Depending on user input, a <code>data.frame</code> or <code>tibble</code> or character
string.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded" class="external-link"><img src="figures/lifecycle-superseded.svg" alt="[Superseded]"></a>
List of values to supply <code>phrdw_datamart</code>. Case sensitive.</p><ul><li><p><code>CDI</code>: Chronic Disease &amp; Injury; links data from Vital Statistics
death records and census-based socio-economic data.</p></li>
<li><p><code>CD Mart</code>: Communicable Diseases; contains communicable disease public
health investigation data from the Panorama public health system.</p></li>
<li><p><code>Enteric</code>: Enteric; links data from the Panorama
public health system and the Sunquest laboratory information
system at PHSA.</p></li>
<li><p><code>Respiratory</code>: Respiratory diseases; includes data from the Sunquest
laboratory information system at PHSA.</p></li>
<li><p><code>STIBBI</code>: Sexually Transmitted Blood Borne Infections; links
data from the Panorama public health system, the Sunquest laboratory
information system at PHSA, STIIS, HAISYS, and legacy laboratory systems.</p></li>
<li><p><code>VPD</code>: Vaccine Preventable Disease; links data from the
Panorama public health system and the Sunquest laboratory information
system at PHSA.</p></li>
<li><p><code>TAT</code>: TBD.</p></li>
<li><p><code>Enteric SU</code>: UAT server of Enteric.</p></li>
<li><p><code>STIBBI SU</code>: UAT server of STIBBI.</p></li>
<li><p><code>STIBBI SA</code>: PROD copy/Staging server of STIBBI.</p></li>
<li><p><code>VPD SU</code>: UAT server of VPD.</p></li>
</ul><p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Using <code>mart</code> and <code>type</code> is preferred. They are not case-sensitive and
more readable.</p>
<p>For now, PHRDW data architecture is either data warehouse/relational
table or  data cubes, depending on which mart. Connection to data
warehouse returns an <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">odbc::dbConnect()</a></code> connection object, whereas
connection to data cube returns an <code>OLAP_Conn</code> object, which is
just a character string under the hood that will be executed by
a back-end C routine.</p>
<p>This means that connection to data warehouse allows for memory-efficient
tools like <code>dbplyr</code> where data is read lazily rather than loaded
into memory.</p>
<p>Users can supply their own connection string using <code>.conn_str</code>. To
distinguish between the different architectures, this parameter needs to
be named list, as either <code>sql</code> or <code>cube</code>. See <code>Examples</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span></span>
<span><span class="co"># The bare minimum required user inputs are `mart` and `dataset_name`.</span></span>
<span><span class="co"># User input is simpler and not case-sensitive.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unlike the legacy approach, which would require more user input.</span></span>
<span><span class="co"># User need to be wary of spelling and case.</span></span>
<span><span class="co"># User also need to provide dates, even if the intent is to retrieve</span></span>
<span><span class="co"># the entire dataset. Without date boundaries, unexpected output may return.</span></span>
<span><span class="co"># Dates would need to go beyond what exist in the database, but user would not</span></span>
<span><span class="co"># have known this info.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  phrdw_datamart_connection <span class="op">=</span> <span class="fu"><a href="connect_to_phrdw.html">connect_to_phrdw</a></span><span class="op">(</span>phrdw_datamart <span class="op">=</span> <span class="st">'CD Mart'</span><span class="op">)</span>,</span>
<span>  phrdw_datamart <span class="op">=</span> <span class="st">'CD Mart'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'Investigation'</span>,</span>
<span>  query_start_date <span class="op">=</span> <span class="st">'1900-01-01'</span>,</span>
<span>  query_end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Incorrect spelling will generate helpful message to assist user.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'dc'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'stibbi'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigations'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter</span></span>
<span><span class="co">## Some arguments are reserved for filters. These remain unchanged from before.</span></span>
<span><span class="co">## They are case- and spelling-sensitive.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  disease <span class="op">=</span> <span class="st">'Anthrax'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  phrdw_datamart_connection <span class="op">=</span> <span class="fu"><a href="connect_to_phrdw.html">connect_to_phrdw</a></span><span class="op">(</span>phrdw_datamart <span class="op">=</span> <span class="st">'CD Mart'</span><span class="op">)</span>,</span>
<span>  phrdw_datamart <span class="op">=</span> <span class="st">'CD Mart'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'Investigation'</span>,</span>
<span>  query_start_date <span class="op">=</span> <span class="st">'1900-01-01'</span>,</span>
<span>  query_end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  disease <span class="op">=</span> <span class="st">'Anthrax'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'stibbi'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  disease <span class="op">=</span> <span class="st">'Chlamydia'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  phrdw_datamart_connection <span class="op">=</span> <span class="fu"><a href="connect_to_phrdw.html">connect_to_phrdw</a></span><span class="op">(</span>phrdw_datamart <span class="op">=</span> <span class="st">'STIBBI'</span><span class="op">)</span>,</span>
<span>  phrdw_datamart <span class="op">=</span> <span class="st">'STIBBI'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'Investigation'</span>,</span>
<span>  query_start_date <span class="op">=</span> <span class="st">'1900-01-01'</span>,</span>
<span>  query_end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  disease <span class="op">=</span> <span class="st">'Chlamydia'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Troubleshooting</span></span>
<span><span class="co">## User can opt to return query instead of data.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  .return_query <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># User can use `.check_params` to examine basic dataset metainfo such as</span></span>
<span><span class="co"># column names and what's being used to filter by default.</span></span>
<span><span class="co"># Note: the output format may look different depending on data source being</span></span>
<span><span class="co"># RDBMS or OLAP (ie. relational DB or data cube).</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  .check_params <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'stibbi'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  .check_params <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># When `.check_params` is supplied with the name of the column (or</span></span>
<span><span class="co"># hierarchy), it will return (nominal) levels.</span></span>
<span><span class="co"># Use with caution: it can return dates and street addresses and that would be</span></span>
<span><span class="co"># a long list.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  .check_params <span class="op">=</span> <span class="st">'source_system'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'stibbi'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  .check_params <span class="op">=</span> <span class="st">'Source System'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Customize filtering (only available in stable usage)</span></span>
<span><span class="co">## Knowing columns and levels can be helpful, as these values can be passed</span></span>
<span><span class="co">## into the function for customized filtering:</span></span>
<span><span class="co">## 1. Enclose the column name with backticks.</span></span>
<span><span class="co">## 2. Pass the value to filter.</span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'cd'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  `source_system` <span class="op">=</span> <span class="st">'EMR'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_phrdw_data</span><span class="op">(</span></span>
<span>  mart <span class="op">=</span> <span class="st">'stibbi'</span>,</span>
<span>  dataset_name <span class="op">=</span> <span class="st">'investigation'</span>,</span>
<span>  `Source System` <span class="op">=</span> <span class="st">'EMR'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># }</span></span>
<span></span>
<span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Data &amp; Informatics, Darren Frizzell, BCCDC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

