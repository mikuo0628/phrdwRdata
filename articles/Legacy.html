<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Legacy Usage of `get_phrdw_data()` • phrdwRdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Legacy Usage of `get_phrdw_data()`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phrdwRdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/FAQ.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/Legacy.html">Legacy Usage of `get_phrdw_data()`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikuo0628/phrdwRdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Legacy Usage of `get_phrdw_data()`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikuo0628/phrdwRdata/blob/main/vignettes/Legacy.Rmd" class="external-link"><code>vignettes/Legacy.Rmd</code></a></small>
      <div class="d-none name"><code>Legacy.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code><a href="../reference/get_phrdw_data.html">phrdwRdata::get_phrdw_data()</a></code> function is designed to
pull data for users in an easy and efficient manner by abstracting away
the nuances of database connection, complexity of querying for OLAP (ie.
data cubes) and relational database (ie. SQL), and easy handling of some
common filters, such as Health Authority Regions, etc.</p>
<p>The redesign of <code>phrdwRdata</code> package removes the
restriction to work in the Microsoft Client of R (ver 3.5.2), but
respects <em>legacy</em> scripts by retaining the order of arguments,
and only updating the functions that are deprecated in R version 4+.</p>
<p><strong>This is an assurance to the users that they do not need to
refactor their</strong> <strong>scripts, and that their old scripts will
continue to work.</strong></p>
<p>That said, it is <em>highly</em> recommended for users to update or
upgrade their workflow to meet modern coding standards.</p>
<p>This vignette collects and revises (only if necessary) past
<code>phrdwRdata</code> tutorials and presents them all in one
place.</p>
</div>
<div class="section level2">
<h2 id="prerequisites-for-legacy-phrdwrdata-package">Prerequisites for legacy <code>phrdwRdata</code> package<a class="anchor" aria-label="anchor" href="#prerequisites-for-legacy-phrdwrdata-package"></a>
</h2>
<p>The BCCDC Analytics Platform (Citrix) is running the required
Microsoft R Client (ver 3.5.2) that comes with <code>olapR</code>
package and OLE DB connection files to drive OLAP (data cube)
operations. No further action needed if using Citrix.</p>
<p>Users who are not using Citrix and want R installed locally will need
to ensure the following are met.</p>
<ol style="list-style-type: decimal">
<li><p>Local PC is running 64-bit Windows.</p></li>
<li>
<p><a href="https://docs.microsoft.com/en-us/machine-learning-server/r-client/install-on-windows" class="external-link">Microsoft
R Client 3.5.2</a>.</p>
<ul>
<li>Alternatively, <a href="https://cran-archive.r-project.org/bin/windows/base/old/3.5.2" class="external-link">CRAN
R client 3.5.2</a>, but will require side- loading (ie. loading packages
you did not install) <code>olapR</code> package which can be potentially
problematic.</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="cd-mart">CD Mart<a class="anchor" aria-label="anchor" href="#cd-mart"></a>
</h2>
<p>Here’s a table of all <code>CD Mart</code> datasets, keys used for
joining, and a brief description if available.</p>
<div class="section level3">
<h3 id="non-tuberculosis-datasets">Non Tuberculosis Datasets<a class="anchor" aria-label="anchor" href="#non-tuberculosis-datasets"></a>
</h3>
<p>The <code>Investigation</code> dataset will retrieve non-identifiable
client attributes such as age and gender, along with Panorama data such
as region, date, etiologic agent and stage.</p>
<p>There are also support to retrieve linked datasets for
<code>Risk Factor</code>s, Signs, <code>Symptom</code>s, and
<code>UDF</code>s. At this time, only <code>Classification Group</code>
== <code>Case</code> can be pulled through the CD Mart datasets (what
does this mean? is this true??? i don’t see this in the code for
CD).</p>
<p><strong>Note:</strong> Only completed data is returned in the linked
datasets. To see investigations where no Risk Factors, Signs &amp;
Symptoms or User Defined forms where completed, a <code>LEFT JOIN</code>
back to the <code>Investigation</code> dataset is required.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="32%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th align="left">Dataset Name</th>
<th align="left">Linkable Key</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Client</td>
<td align="left">client_id</td>
<td align="left">Retrieves patients data with an option to include
identifiers.</td>
</tr>
<tr class="even">
<td align="left">Complication</td>
<td align="left">investigation_id, encounter_id</td>
<td align="left">Retrieves complication data</td>
</tr>
<tr class="odd">
<td align="left">Contacts</td>
<td align="left">client_id, disease_event_id,
contact_disease_event_id</td>
<td align="left">Retrieves Investigations based on the
<code>Is A Contact Investigation</code> or
<code>Ever A Contact Client</code> flags. Includes an option to retrieve
patient and aboriginal identifiers.</td>
</tr>
<tr class="even">
<td align="left">Investigation</td>
<td align="left">client_id, investigation_id, outbreak_id</td>
<td align="left">Retrieves Investigation and de-identified patient
data.</td>
</tr>
<tr class="odd">
<td align="left">Lab</td>
<td align="left">client_id, investigation_id, encounter_id,
requisition_id, test_id, requisition_specimen_id</td>
<td align="left">Retrieves Public Health System Laboratory data.</td>
</tr>
<tr class="even">
<td align="left">Observation</td>
<td align="left">disease_event_id</td>
<td align="left">Retrieves the Observations from the Signs and Symptoms
data.</td>
</tr>
<tr class="odd">
<td align="left">Outbreaks</td>
<td align="left">investigation_id</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Risk Factor</td>
<td align="left">disease_event_id, risk_factor_id</td>
<td align="left">Retrieves Risk Factors that are marked Pertinent to an
Investigation.</td>
</tr>
<tr class="odd">
<td align="left">Symptom</td>
<td align="left">disease_event_id</td>
<td align="left">Retrieves Signs and Symptoms data.</td>
</tr>
<tr class="even">
<td align="left">Transmission Events</td>
<td align="left">disease_event_id</td>
<td align="left">Retrieves Transmission Events based on the source
Investigation.</td>
</tr>
<tr class="odd">
<td align="left">UDF</td>
<td align="left">disease_event_id, form_instance_disease_event_id</td>
<td align="left">Retrieves User Defined Forms data.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="tuberculosis-datasets">Tuberculosis Datasets<a class="anchor" aria-label="anchor" href="#tuberculosis-datasets"></a>
</h3>
<table class="table">
<colgroup>
<col width="7%">
<col width="34%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th align="left">Dataset Name</th>
<th align="left">Linkable Key</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TB Client</td>
<td align="left">client_id</td>
<td align="left">Retrieves TB specific patients data with an option to
include identifiers.</td>
</tr>
<tr class="even">
<td align="left">TB Contacts</td>
<td align="left">client_id, disease_event_id,
contact_disease_event_id</td>
<td align="left">Retrieves Investigations based on the
<code>Is A Contact Investigation</code> or
<code>Ever A Contact Client</code> flags. Includes an option to retrieve
patient identifiers and aboriginal fields</td>
</tr>
<tr class="odd">
<td align="left">TB Investigation</td>
<td align="left">client_id, disease_event_id</td>
<td align="left">Retrieves TB specific investigation data. Includes an
option to retrieve aboriginal fields if authorized.</td>
</tr>
<tr class="even">
<td align="left">TB Lab</td>
<td align="left">client_id, investigation_id, encounter_id,
requisition_id, test_id, result_id, requisition_specimen_id</td>
<td align="left">Retrieves TB specific laboratory data.</td>
</tr>
<tr class="odd">
<td align="left">TB Transmission Events</td>
<td align="left">disease_event_id</td>
<td align="left">Retrieves Transmission Events based on the source
Investigation.</td>
</tr>
<tr class="even">
<td align="left">TB TST Client</td>
<td align="left">client_id, encounter_id</td>
<td align="left">Retrieves all TST data for a client, regardless of if
the TST is associated with an Investigation.</td>
</tr>
<tr class="odd">
<td align="left">TB TST Investigation</td>
<td align="left">client_id, investigation_id, encounter_id</td>
<td align="left">Retrieves TST data that is associated with an
Investigation.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="script-set-up">Script set up<a class="anchor" aria-label="anchor" href="#script-set-up"></a>
</h3>
<ol style="list-style-type: decimal">
<li>You will need to load or side-load the following:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dependencies for `phrdwRdata`</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eddelbuettel/digest" class="external-link">digest</a></span><span class="op">)</span>  </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RODBC</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RODBCext</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lib_loc</span> <span class="op">&lt;-</span> <span class="st">"//Phsabc/root/BCCDC/Groups/Analytics_Resources/Coding/R/Library"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">olapR</span>,      lib.loc <span class="op">=</span> <span class="va">log_loc</span><span class="op">)</span> <span class="co"># if not using MS R Client</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">phrdwRdata</span>, lib.loc <span class="op">=</span> <span class="va">log_loc</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create a connection object</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phrdw_datamart</span> <span class="op">&lt;-</span> <span class="st">'CD Mart'</span></span>
<span><span class="va">phrdw_datamart_connection</span> <span class="op">&lt;-</span> <span class="fu">phrdwRdata</span><span class="fu">::</span><span class="fu"><a href="../reference/connect_to_phrdw.html">connect_to_phrdw</a></span><span class="op">(</span><span class="va">phrdw_datamart</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Set the start and end dates of your query</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query_start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2016-01-01'</span><span class="op">)</span></span>
<span><span class="va">query_end_date</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2018-01-01'</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Additional optional parameters</li>
</ol>
<ul>
<li><code>disease</code></li>
<li><code>classification</code></li>
<li><code>surveillance_condition</code></li>
<li><code>surveillance_region_ha</code></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveillance_condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Legionella Infection"</span><span class="op">)</span></span>
<span><span class="va">classification</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Confirmed"</span>,</span>
<span>                            <span class="st">"Confirmed Epi-Linked"</span>,</span>
<span>                            <span class="st">"Clinical"</span>,</span>
<span>                            <span class="st">"Probable"</span><span class="op">)</span></span>
<span><span class="va">surveillance_region_ha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Interior"</span>,</span>
<span>                            <span class="st">"Fraser"</span>,</span>
<span>                            <span class="st">"Northern"</span>,</span>
<span>                            <span class="st">"Vancouver Coastal"</span>,</span>
<span>                            <span class="st">"Vancouver Island"</span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Supply the above parameters in <code><a href="../reference/get_phrdw_data.html">get_phrdw_data()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_name</span> <span class="op">&lt;-</span> <span class="st">"Investigation"</span></span>
<span><span class="va">investigation_dataset</span>  <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/get_phrdw_data.html">get_phrdw_data</a></span><span class="op">(</span></span>
<span>    phrdw_datamart_connection <span class="op">=</span> <span class="va">phrdw_datamart_connection</span>,</span>
<span>    phrdw_datamart            <span class="op">=</span> <span class="va">phrdw_datamart</span>, </span>
<span>    dataset_name              <span class="op">=</span> <span class="va">dataset_name</span>, </span>
<span>    query_start_date          <span class="op">=</span> <span class="va">query_start_date</span>, </span>
<span>    query_end_date            <span class="op">=</span> <span class="va">query_end_date</span>,</span>
<span>    surveillance_condition    <span class="op">=</span> <span class="va">surveillance_condition_vector</span>,</span>
<span>    classification            <span class="op">=</span> <span class="va">classification_vector</span>,</span>
<span>    surveillance_region_ha    <span class="op">=</span> <span class="va">surveillance_region_ha_vector</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dataset_name</span> <span class="op">&lt;-</span> <span class="st">"UDF"</span></span>
<span><span class="va">udf_dataset</span>  <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/get_phrdw_data.html">get_phrdw_data</a></span><span class="op">(</span></span>
<span>    phrdw_datamart_connection <span class="op">=</span> <span class="va">phrdw_datamart_connection</span>,</span>
<span>    phrdw_datamart            <span class="op">=</span> <span class="va">phrdw_datamart</span>, </span>
<span>    dataset_name              <span class="op">=</span> <span class="va">dataset_name</span>, </span>
<span>    query_start_date          <span class="op">=</span> <span class="va">query_start_date</span>, </span>
<span>    query_end_date            <span class="op">=</span> <span class="va">query_end_date</span>,</span>
<span>    surveillance_condition    <span class="op">=</span> <span class="va">surveillance_condition_vector</span>,</span>
<span>    classification            <span class="op">=</span> <span class="va">classification_vector</span>,</span>
<span>    surveillance_region_ha    <span class="op">=</span> <span class="va">surveillance_region_ha_vector</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="access-to-data-cubes">Access to Data Cubes<a class="anchor" aria-label="anchor" href="#access-to-data-cubes"></a>
</h2>
<div class="section level3">
<h3 id="cdi-mart">CDI Mart<a class="anchor" aria-label="anchor" href="#cdi-mart"></a>
</h3>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Data &amp; Informatics, Darren Frizzell, BCCDC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
